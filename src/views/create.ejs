<%- include('partials/layout_start', { title: 'Create New Page' }) %>

    <article class="wiki-article">
        <h1 style="border: none; margin-bottom: 2rem;">Create a New Page</h1>

        <form action="/create" method="POST" class="wiki-form">
            <div class="form-group">
                <label for="title">Page Title</label>
                <input type="text" id="title" name="title" required placeholder="e.g. My New Page"
                    value="<%= prefilledTitle %>">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="slug">URL Slug</label>
                    <input type="text" id="slug" name="slug" required placeholder="e.g. my-new-page">
                </div>
                <div class="form-group">
                    <label for="topic_id">Topic</label>
                    <select id="topic_id" name="topic_id">
                        <option value="">No Topic</option>
                        <% allTopics.forEach(function(topic) { %>
                            <option value="<%= topic.id %>">
                                <%= topic.name %>
                            </option>
                            <% }); %>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="category">Custom Category Label (Optional)</label>
                <input type="text" id="category" name="category" placeholder="e.g. Technology, Science, History...">
            </div>

            <div class="form-group">
                <label for="content">Markdown Content</label>
                <textarea id="content" name="content" required placeholder="# Start writing here..."
                    style="min-height: 400px;"></textarea>
            </div>

            <div class="form-actions" style="display: flex; gap: 1rem; margin-top: 2rem;">
                <button type="submit" class="btn-primary">Create Page</button>
                <a href="/" class="btn-secondary"
                    style="background: #f1f3f5; padding: 0.6rem 1.25rem; border-radius: var(--radius); text-decoration: none; color: var(--text-main); font-weight: 600;">Cancel</a>
            </div>
        </form>
    </article>

    <script>
        const titleInput = document.getElementById('title');
        const slugInput = document.getElementById('slug');

        function generateSlug(text) {
            return text
                .toString()
                .toLowerCase()
                .trim()
                .replace(/\s+/g, '-')
                .replace(/[^\w\-]+/g, '')
                .replace(/\-\-+/g, '-');
        }

        if (titleInput.value) {
            slugInput.value = generateSlug(titleInput.value);
        }

        titleInput.addEventListener('input', () => {
            slugInput.value = generateSlug(titleInput.value);
        });
    </script>

    <%- include('partials/layout_end') %>