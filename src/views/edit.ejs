<%- include('partials/layout_start', { title: 'Editing: ' + page.title }) %>

    <article class="wiki-article">
        <h1 style="border: none; margin-bottom: 2rem;">Editing: <%= page.title %>
        </h1>

        <form action="/wiki/<%= page.slug %>/edit" method="POST" class="wiki-form">
            <div class="form-group">
                <label for="title">Page Title</label>
                <input type="text" id="title" name="title" value="<%= page.title %>" required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="slug">Slug (URL Name)</label>
                    <input type="text" id="slug" name="slug" value="<%= page.slug %>" required>
                </div>
                <div class="form-group">
                    <label for="topic_id">Topic</label>
                    <select id="topic_id" name="topic_id">
                        <option value="">No Topic</option>
                        <% allTopics.forEach(function(topic) { %>
                            <option value="<%= topic.id %>" <%=(page.topic_id==topic.id) ? 'selected' : '' %>><%=
                                    topic.name %>
                            </option>
                            <% }); %>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="category">Custom Category Label (Optional)</label>
                <input type="text" id="category" name="category" value="<%= page.category || '' %>"
                    placeholder="e.g. Technology...">
            </div>

            <div class="form-group">
                <label for="content">Page Content (Markdown)</label>
                <textarea id="content" name="content" required style="min-height: 400px;"><%= page.content %></textarea>
            </div>

            <div class="form-actions" style="display: flex; gap: 1rem; margin-top: 2rem;">
                <button type="submit" class="btn-primary">Save Changes</button>
                <a href="/wiki/<%= page.slug %>" class="btn-secondary"
                    style="background: #f1f3f5; padding: 0.6rem 1.25rem; border-radius: var(--radius); text-decoration: none; color: var(--text-main); font-weight: 600;">Cancel</a>
            </div>
        </form>
    </article>

    <script>
    const titleInput = document.getElementById('title');
    const slugInput = document.getElementById('slug');

    let slugEdited = false;
    slugInput.addEventListener('input', () => slugEdited = true);

    titleInput.addEventListener('input', function () {
        if (slugEdited) return;
        const val = this.value;
        const slug = val.toLowerCase()
            .replace(/[^a-z0-9 -]/g, '')
            .replace(/\s+/g, '-')
            .replace(/-+/g, '-');
        slugInput.value = slug;
    });
    </script>

    <%- include('partials/layout_end') %>