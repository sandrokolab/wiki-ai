<aside class="sidebar-left">
    <div class="sidebar-header">
        <div class="team-logo">
            <div class="logo-icon"><i class="ph ph-brain"></i></div>
            <span>Wiki AI</span>
            <i class="ph ph-caret-down logo-caret"></i>
        </div>
    </div>

    <div class="user-profile-nav">
        <% if (currentUser) { %>
            <div class="avatar">
                <%= currentUser.username.charAt(0).toUpperCase() %>
            </div>
            <div class="user-info">
                <span class="user-name">
                    <%= currentUser.username %>
                </span>
                <a href="/logout" class="logout-link">Logout</a>
            </div>
            <% } else { %>
                <a href="/login" class="nav-item">
                    <i class="ph ph-user"></i>
                    <span>Login</span>
                </a>
                <% } %>
    </div>

    <nav class="side-nav">
        <a href="/" class="nav-item">
            <i class="ph ph-house"></i>
            <span>Home</span>
        </a>
        <a href="/indice" class="nav-item">
            <i class="ph ph-file-text"></i>
            <span>All Pages</span>
        </a>
        <a href="/categorias" class="nav-item">
            <i class="ph ph-map-trifold"></i>
            <span>Content Map</span>
        </a>
        <a href="/create" class="nav-item">
            <i class="ph ph-plus-circle"></i>
            <span>New Content</span>
        </a>
    </nav>

    <!-- Favorite Topics -->
    <% if (favoriteTopics && favoriteTopics.length> 0) { %>
        <details open>
            <summary>
                <i class="ph ph-bookmark-simple"></i>
                <span>Favorite Topics</span>
                <i class="ph ph-caret-down section-caret"></i>
            </summary>
            <div class="section-content">
                <% favoriteTopics.forEach(function(topic) { %>
                    <a href="/categoria/<%= topic.name %>" class="nav-item sub-item">
                        <span class="topic-dot" style="background-color: <%= topic.color %>;"></span>
                        <%= topic.name %>
                    </a>
                    <% }); %>
            </div>
        </details>
        <% } %>

            <!-- Favorite Pages -->
            <% if (favoritePages && favoritePages.length> 0) { %>
                <details open>
                    <summary>
                        <i class="ph ph-star"></i>
                        <span>Favorites</span>
                        <i class="ph ph-caret-down section-caret"></i>
                    </summary>
                    <div class="section-content">
                        <% favoritePages.forEach(function(page) { %>
                            <a href="/wiki/<%= page.slug %>" class="nav-item sub-item">
                                <i class="ph ph-file-text"></i>
                                <span class="truncate-text">
                                    <%= page.title %>
                                </span>
                            </a>
                            <% }); %>
                    </div>
                </details>
                <% } %>

                    <!-- User Drafts (Author Only) -->
                    <% if (userDrafts && userDrafts.length> 0) { %>
                        <details open>
                            <summary>
                                <i class="ph ph-file-dashed"></i>
                                <span>Drafts</span>
                                <i class="ph ph-caret-down section-caret"></i>
                            </summary>
                            <div class="section-content">
                                <% userDrafts.forEach(function(draft) { %>
                                    <a href="/wiki/<%= draft.slug %>" class="nav-item sub-item">
                                        <i class="ph ph-file-dashed"></i>
                                        <span class="truncate-text">
                                            <%= draft.title %>
                                        </span>
                                    </a>
                                    <% }); %>
                            </div>
                        </details>
                        <% } %>

                            <details open>
                                <summary>
                                    <i class="ph ph-user-focus"></i>
                                    <span>My Topics</span>
                                    <i class="ph ph-caret-down section-caret"></i>
                                </summary>
                                <div class="section-content">
                                    <% userTopics.forEach(function(topic) { %>
                                        <a href="/categoria/<%= topic.name %>" class="nav-item sub-item">
                                            <span class="topic-dot"
                                                style="background-color: <%= topic.color %>;"></span>
                                            <%= topic.name %>
                                        </a>
                                        <% }); %>
                                            <% if (userTopics.length===0) { %>
                                                <p class="empty-side-text">No followed topics yet.</p>
                                                <% } %>
                                </div>
                            </details>

                            <details open>
                                <summary>
                                    <i class="ph ph-bookmarks"></i>
                                    <span>All Topics</span>
                                    <i class="ph ph-caret-down section-caret"></i>
                                </summary>
                                <div class="section-content">
                                    <% allTopics.forEach(function(topic) { %>
                                        <a href="/categoria/<%= topic.name %>" class="nav-item sub-item">
                                            <i class="<%= topic.icon || 'ph ph-hash' %>"
                                                style="color: <%= topic.color %>;"></i>
                                            <%= topic.name %>
                                        </a>
                                        <% }); %>

                                            <button class="btn-create-side" onclick="openTopicModal()">
                                                <i class="ph ph-plus-circle"></i>
                                                <span>Create Topic</span>
                                            </button>
                                </div>
                            </details>
                            </div>

                            <!-- Create Topic Modal -->
                            <div id="topicModal" class="modal">
                                <div class="modal-content">
                                    <span class="close" onclick="closeTopicModal()">&times;</span>
                                    <h2>Create New Topic</h2>
                                    <form id="createTopicForm" onsubmit="handleCreateTopic(event)">
                                        <div class="form-group">
                                            <label>Name</label>
                                            <input type="text" name="name" required
                                                placeholder="Project Alpha, Research...">
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Color</label>
                                                <input type="color" name="color" value="#6366f1">
                                            </div>
                                            <div class="form-group">
                                                <label>Icon (Phosphor class)</label>
                                                <input type="text" name="icon" value="ph-hash"
                                                    placeholder="ph-brain, ph-code...">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>Description</label>
                                            <textarea name="description"
                                                placeholder="What is this topic about?"></textarea>
                                        </div>
                                        <button type="submit" class="btn-primary" style="width: 100%;">Save
                                            Topic</button>
                                    </form>
                                </div>
                            </div>

                            <script>
        function openTopicModal() {
            document.getElementById('topicModal').style.display = 'block';
        }
        function closeTopicModal() {
            document.getElementById('topicModal').style.display = 'none';
        }
        async function handleCreateTopic(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                const res = await fetch('/topics/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (res.ok) {
                    location.reload();
                } else {
                    alert('Error creating topic. Make sure the name is unique.');
                }
            } catch (err) {
                console.error(err);
            }
        }
                            </script>
</aside>